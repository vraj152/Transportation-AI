<!doctype html>
<html>
	<head>
		<title>Upload Files</title>
		
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">


		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
		<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.3.5/css/swiper.min.css'>
		<link rel="stylesheet" href="static/style.css">
		<link rel="stylesheet" href="https://bootswatch.com/4/cyborg/bootstrap.min.css">
		
		<script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.3.5/js/swiper.min.js'></script>
		
		<script type="text/javascript">
			function server_call(){
				var formData = new FormData();
				var total = document.getElementById('images').files.length;
				
				for (var x = 0; x < total; x++) {
					formData.append("files[]", document.getElementById('images').files[x]);
				}
				
				sendDataToServer(formData);
			}
			function sendDataToServer(formData){
				console.log(formData);
			
				var SERVER_URL = "http://localhost:5000/";
				var REST_API = SERVER_URL + "objectDetect";
				
				var xhttp = new XMLHttpRequest();
				xhttp.open("POST", REST_API, true);
				
				xhttp.onload = function (e){
					if (xhttp.readyState === 4)
					{
						if (xhttp.status === 200)
						{
							console.log("RESPONSE RECEIVED!");
							var data = JSON.parse(xhttp.responseText);
							console.log(data);
							
							display_output(data);
						}else{
							alert("Error Occured! Check logs");
							console.error("Server error: ", xhttp.statusText);
						}
					}
				};
				xhttp.onerror = function (e)
				{
					console.error("Error connecting to: ", SERVER_URL);
				};
				
				xhttp.send(formData);
			}
			
			function display_output(server_data){
				var data = server_data["ls"];
				
				var most_outer_div = document.getElementById("main_blog_div");
				var inner_div = document.getElementById("sub_blog_div");
				var slider_div = document.getElementById("slider_div");
				
				inner_div.innerHTML = "";
				slider_div.innerHTML = "";
				
				for(var x = 0; x < data.length; x++){
					var item_div = document.createElement("div");
					
					if(x == 0){
						if(data.length == 1){
							item_div.setAttribute("class", "blog-slider__item swiper-slide swiper-slide-active swiper-slide-next swiper-slide-prev");
						}else{
							item_div.setAttribute("class", "blog-slider__item swiper-slide swiper-slide-active");
						}
						
						item_div.setAttribute("style","width: 750px ; opacity: 1; transform: translate3d(" + ((-750) * x).toString() + "px, 0px, 0px); transition-duration: 0ms;");
					}else{
						if(x == data.length - 1){
							item_div.setAttribute("class", "blog-slider__item swiper-slide swiper-slide-prev");
						}else{
							item_div.setAttribute("class", "blog-slider__item swiper-slide swiper-slide-next");
						}
						item_div.setAttribute("style","width: 750px ; opacity: 0; transform: translate3d(" + ((-750) * x).toString() + "px, 0px, 0px); transition-duration: 0ms;");
					}
					
					
					var image_div = document.createElement("div");
					image_div.setAttribute("class", "blog-slider__img");
					
					var img = document.createElement("img");
					img.setAttribute("src", data[x]["path"]);
					
					image_div.appendChild(img);
					
					//<a href="#" class="blog-slider__button">READ MORE</a>
					//<a data-target="#myModal" data-toggle="modal" class="MainNavText" id="MainNavHelp" href="#myModal">HELP</a>
					//<span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button" aria-label="Go to slide 3"></span>
					
					var a_tag = document.createElement("a");
					a_tag.setAttribute("data-target", "#myModal");
					a_tag.setAttribute("data-toggle", "modal");
					a_tag.setAttribute("href", "#myModal");
					a_tag.setAttribute("class", "blog-slider__button");
					a_tag.appendChild(document.createTextNode("READ MORE"));
					
					item_div.appendChild(image_div);
					item_div.appendChild(a_tag);
					
					var span = document.createElement("span");
					
					if(x == 0){
						span.setAttribute("class", "swiper-pagination-bullet swiper-pagination-bullet-active");
					}else{
						span.setAttribute("class", "swiper-pagination-bullet");
					}
					
					span.setAttribute("tabindex", "0");
					span.setAttribute("role", "button");
					span.setAttribute("aria-label", "Go to slide " + (x+1).toString());
					
					slider_div.appendChild(span);
					inner_div.appendChild(item_div);
				}
				var swiper = new Swiper('.blog-slider', {
					  spaceBetween: 30,
					  effect: 'fade',
					  loop: true,
					  mousewheel: {
						invert: false,
					  },
					  // autoHeight: true,
					  pagination: {
						el: '.blog-slider__pagination',
						clickable: true,
					  },
					  obeserver : true,
					  observerParents : true,
					  preventClicks: false,
					  preventClicksPropagation: false
				});
				most_outer_div.style.display = 'inherit';
			}
			
			function process_stat(){
				console.log("CLICKED!");
				var button = document.createElement("button");
				button.setAttribute("data-toggle", "modal");
				button.setAttribute("data-target", "#myModal");
				console.log(button);
				button.click();
			}
		</script>
	</head>
	<body>
		<div>
			<center>
				<h2>Select file(s) to upload</h2>
				<input type="file" name="files[]" id="images" multiple="true" autocomplete="off" required>
				<input type="button" value="Submit" onclick="server_call()">
			</center>
		</div>
		<div class="blog-slider" id="main_blog_div" style="display:none">
			<div class="blog-slider__wrp swiper-wrapper" id="sub_blog_div" >
			</div>
			<div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets" id="slider_div">
			</div>
		</div>
			
		<div class="modal" id="myModal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">Modal Heading</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<div class="modal-body">
						<table class="table table-striped">
						<thead>
							<tr>
								<th>Firstname</th>
								<th>Lastname</th>
								<th>Email</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>John</td>
								<td>Doe</td>
								<td>john@example.com</td>
							</tr>	
							<tr>
								<td>Mary</td>
								<td>Moe</td>
								<td>mary@example.com</td>
							</tr>
						</tbody>
						</table>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		
		<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
		<script  src="static/script.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		
	</body>
</html>